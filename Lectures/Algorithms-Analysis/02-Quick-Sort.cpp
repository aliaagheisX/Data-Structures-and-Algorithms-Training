#include <bits/stdc++.h>
using namespace std;

void print_array(int arr[], int n) {
    for (int i = 0; i < n; i++)
        cout << arr[i] << ' ';
    cout << '\n';
}

int partition(int arr[], int f, int e) {
    int pivot = arr[(f + e) / 2];
    int i = f, j = e;
    while (i <= j) {
        while (arr[i] < pivot) i++;
        while (arr[j] > pivot) j--;
        if (i <= j) {
            swap(arr[i], arr[j]);
            i++;
            j--;
        }
    }
	return i;
}

void quick_sort_recursive(int arr[], int f, int e) {
    if (f < e) {
		int p = partition(arr, f, e);
        quick_sort_recursive(arr, f, p-1);
        quick_sort_recursive(arr, p, e);
    }
}

void quick_sort_iterative(int arr[], int f, int e) {
    int stack[e - f + 1];
    int top = -1;
    top ++;
    stack[top] = f;
    top ++;
    stack[top] = e;
    while (top >= 0) {
        e = stack[top];
        top --;
        f = stack[top];
        top --;
        int p = partition(arr, f, e);
        if (p - 1 > f) {
            top ++;
            stack[top] = f;
            top ++;
            stack[top] = p - 1;
        }
        if (p < e) {
            top ++;
            stack[top] = p;
            top ++;
            stack[top] = e;
        }
    }
}

/*
array
35 33 42 10 14 19 27 44 35 33 42 10 14 19 27 44 

f = 0, e = 15, pivot = 44
    i = 2, j = 15
    i = 3, j = 14
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    35 33 44 10 14 19 27 44 35 33 42 10 14 19 27 42 
    i = 7, j = 14
    i = 8, j = 13
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    35 33 44 10 14 19 27 27 35 33 42 10 14 19 44 42 
    i = 10, j = 13
    i = 11, j = 12
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    35 33 44 10 14 19 27 27 35 33 19 10 14 42 44 42 
    i = 13, j = 12
    i = 13, j = 12
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    35 33 44 10 14 19 27 27 35 33 19 10 14 42 44 42 
i = 13, j = 12

f = 0, e = 12, pivot = 27
    i = 0, j = 12
    i = 1, j = 11
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    14 33 44 10 14 19 27 27 35 33 19 10 35 42 44 42 
    i = 1, j = 11
    i = 2, j = 10
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    14 10 44 10 14 19 27 27 35 33 19 33 35 42 44 42 
    i = 2, j = 10
    i = 3, j = 9
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    14 10 19 10 14 19 27 27 35 33 44 33 35 42 44 42 
    i = 6, j = 7
    i = 7, j = 6
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    14 10 19 10 14 19 27 27 35 33 44 33 35 42 44 42 
i = 7, j = 6

f = 0, e = 6, pivot = 10
    i = 0, j = 3
    i = 1, j = 2
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 19 14 14 19 27 27 35 33 44 33 35 42 44 42 
    i = 1, j = 1
    i = 2, j = 0
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 19 14 14 19 27 27 35 33 44 33 35 42 44 42 
i = 2, j = 0

f = 0, e = 1, pivot = 10
    i = 0, j = 1
    i = 1, j = 0
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 19 14 14 19 27 27 35 33 44 33 35 42 44 42 
i = 1, j = 0

f = 2, e = 6, pivot = 14
    i = 2, j = 4
    i = 3, j = 3
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 35 33 44 33 35 42 44 42 
    i = 3, j = 3
    i = 4, j = 2
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 35 33 44 33 35 42 44 42 
i = 4, j = 2

f = 2, e = 3, pivot = 14
    i = 2, j = 3
    i = 3, j = 2
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 35 33 44 33 35 42 44 42 
i = 3, j = 2

f = 4, e = 6, pivot = 19
    i = 4, j = 5
    i = 5, j = 4
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 35 33 44 33 35 42 44 42 
i = 5, j = 4

f = 5, e = 6, pivot = 19
    i = 5, j = 5
    i = 6, j = 4
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 35 33 44 33 35 42 44 42 
i = 6, j = 4

f = 7, e = 12, pivot = 33
    i = 8, j = 11
    i = 9, j = 10
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 44 35 35 42 44 42 
    i = 9, j = 9
    i = 10, j = 8
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 44 35 35 42 44 42 
i = 10, j = 8

f = 7, e = 9, pivot = 33
    i = 8, j = 9
    i = 9, j = 8
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 44 35 35 42 44 42 
i = 9, j = 8

f = 7, e = 8, pivot = 27
    i = 7, j = 7
    i = 8, j = 6
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 44 35 35 42 44 42 
i = 8, j = 6

f = 10, e = 12, pivot = 35
    i = 10, j = 12
    i = 11, j = 11
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 35 35 44 42 44 42 
    i = 11, j = 11
    i = 12, j = 10
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 35 35 44 42 44 42 
i = 12, j = 10

f = 10, e = 11, pivot = 35
    i = 10, j = 11
    i = 11, j = 10
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 35 35 44 42 44 42 
i = 11, j = 10

f = 13, e = 15, pivot = 44
    i = 13, j = 14
    i = 14, j = 13
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 35 35 44 44 42 42 
i = 14, j = 13

f = 14, e = 15, pivot = 42
    i = 14, j = 15
    i = 15, j = 14
    0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15
    10 10 14 14 19 19 27 27 33 33 35 35 44 44 42 42 
i = 15, j = 14

result
10 10 14 14 19 19 27 27 33 33 35 35 44 44 42 42
*/

int main() {

    int n = 16;
    int arr[] = {35, 33, 42, 10, 14, 19, 27, 44, 35, 33, 42, 10, 14, 19, 27, 44};
    
    print_array(arr, n);
    cout << "quick_sort: \n";
    quick_sort_iterative(arr, 0, n-1);
    print_array(arr, n);

}